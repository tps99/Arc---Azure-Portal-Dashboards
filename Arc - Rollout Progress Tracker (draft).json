{
  "properties": {
    "lenses": {
      "0": {
        "order": 0,
        "parts": {
          "0": {
            "position": {
              "x": 0,
              "y": 0,
              "colSpan": 19,
              "rowSpan": 1
            },
            "metadata": {
              "inputs": [],
              "type": "Extension/HubsExtension/PartType/MarkdownPart",
              "settings": {
                "content": {
                  "content": "<div style='line-height:50px;'>\n<span style='font-size:20px;font-weight:bold'>ARC - Rollout Progress Tracker - </span>\n<span style='font-size:20px'>This Dashboard includes several queries which can be used for tracking the progress of Arc rollout</span>\n</div>\n",
                  "title": "",
                  "subtitle": "",
                  "markdownSource": 1,
                  "markdownUri": ""
                }
              }
            }
          },
          "1": {
            "position": {
              "x": 0,
              "y": 1,
              "colSpan": 3,
              "rowSpan": 5
            },
            "metadata": {
              "inputs": [
                {
                  "name": "chartType",
                  "isOptional": true
                },
                {
                  "name": "isShared",
                  "isOptional": true
                },
                {
                  "name": "queryId",
                  "isOptional": true
                },
                {
                  "name": "formatResults",
                  "isOptional": true
                },
                {
                  "name": "partTitle",
                  "value": "Query 1",
                  "isOptional": true
                },
                {
                  "name": "queryScope",
                  "value": {
                    "scope": 0,
                    "values": []
                  },
                  "isOptional": true
                },
                {
                  "name": "query",
                  "value": "// Count of all Servers\nresources\n| where type =~ 'microsoft.hybridcompute/machines'\n| summarize ServerCount = count()",
                  "isOptional": true
                }
              ],
              "type": "Extension/HubsExtension/PartType/ArgQuerySingleValueTile",
              "settings": {},
              "partHeader": {
                "title": "All Servers",
                "subtitle": "Count of Servers registered to Arc"
              }
            }
          },
          "2": {
            "position": {
              "x": 3,
              "y": 1,
              "colSpan": 6,
              "rowSpan": 6
            },
            "metadata": {
              "inputs": [
                {
                  "name": "isShared",
                  "isOptional": true
                },
                {
                  "name": "queryId",
                  "isOptional": true
                },
                {
                  "name": "formatResults",
                  "isOptional": true
                },
                {
                  "name": "partTitle",
                  "value": "Query 1",
                  "isOptional": true
                },
                {
                  "name": "query",
                  "value": "//Servers by OS Version\nresources\n| where type =~ 'microsoft.hybridcompute/machines'\n| extend OSVersion = tostring(properties.osSku)\n| project OSVersion\n| summarize ServerCount = count() by OSVersion",
                  "isOptional": true
                },
                {
                  "name": "chartType",
                  "value": 2,
                  "isOptional": true
                },
                {
                  "name": "queryScope",
                  "value": {
                    "scope": 0,
                    "values": []
                  },
                  "isOptional": true
                }
              ],
              "type": "Extension/HubsExtension/PartType/ArgQueryChartTile",
              "settings": {},
              "partHeader": {
                "title": "Servers by OS",
                "subtitle": "Servers on Arc by OS Version"
              }
            }
          },
          "3": {
            "position": {
              "x": 9,
              "y": 1,
              "colSpan": 10,
              "rowSpan": 6
            },
            "metadata": {
              "inputs": [
                {
                  "name": "chartType",
                  "isOptional": true
                },
                {
                  "name": "isShared",
                  "isOptional": true
                },
                {
                  "name": "queryId",
                  "isOptional": true
                },
                {
                  "name": "formatResults",
                  "isOptional": true
                },
                {
                  "name": "partTitle",
                  "value": "Query 1",
                  "isOptional": true
                },
                {
                  "name": "queryScope",
                  "value": {
                    "scope": 0,
                    "values": []
                  },
                  "isOptional": true
                },
                {
                  "name": "query",
                  "value": "// Arc Queries - All Windows Servers by Subscription, Resource Group, Type\r\nresources\r\n| where type =~ 'microsoft.hybridcompute/machines'\r\n| extend CoreCount = toint (properties.detectedProperties.logicalCoreCount)\r\n| extend OSVersion = tostring(properties.osSku)\r\n| extend ESUAttached = iff(properties.licenseProfile.esuProfile.esuKeyState ==\"Inactive\", 0, 1)\r\n| join kind=inner (\r\n    resourcecontainers\r\n    | where type == 'microsoft.resources/subscriptions'\r\n    | project subscriptionId, subscriptionName = name)\r\n    on subscriptionId\r\n| project subscriptionName, resourceGroup, OSVersion, ESUAttached, CoreCount\r\n| summarize ServerCount = count()  by subscriptionName, resourceGroup, OSVersion",
                  "isOptional": true
                }
              ],
              "type": "Extension/HubsExtension/PartType/ArgQueryGridTile",
              "settings": {},
              "partHeader": {
                "title": "Servers -Summary",
                "subtitle": "All Servers by Subscription, Resource Group, OS Version"
              }
            }
          },
          "4": {
            "position": {
              "x": 0,
              "y": 7,
              "colSpan": 6,
              "rowSpan": 8
            },
            "metadata": {
              "inputs": [
                {
                  "name": "isShared",
                  "isOptional": true
                },
                {
                  "name": "queryId",
                  "isOptional": true
                },
                {
                  "name": "formatResults",
                  "isOptional": true
                },
                {
                  "name": "partTitle",
                  "value": "Query 1",
                  "isOptional": true
                },
                {
                  "name": "chartType",
                  "value": 2,
                  "isOptional": true
                },
                {
                  "name": "queryScope",
                  "value": {
                    "scope": 0,
                    "values": []
                  },
                  "isOptional": true
                },
                {
                  "name": "query",
                  "value": "// Run query to see results.\nresources\n| where type == \"microsoft.azurearcdata/sqlserverinstances\"\n//| where type == \"microsoft.hybridcompute/machines\"\n//| where properties.detectedProperties.mssqldiscovered == \"true\"\n| extend d=parse_json(properties)\n| extend Patch=d[\"patchLevel\"]\n| extend SQLVersion=d[\"version\"]\n| extend  Edition=d[\"edition\"]\n| extend License=d[\"licenseType\"]\n| project name, Patch, SQLVersion, Edition, License\n| summarize count() by tostring(SQLVersion)",
                  "isOptional": true
                }
              ],
              "type": "Extension/HubsExtension/PartType/ArgQueryChartTile",
              "settings": {},
              "partHeader": {
                "title": "SQL Server by Version",
                "subtitle": "SQL Servers on Arc hosted servers by SQL Version"
              }
            }
          },
          "5": {
            "position": {
              "x": 6,
              "y": 7,
              "colSpan": 4,
              "rowSpan": 2
            },
            "metadata": {
              "inputs": [
                {
                  "name": "chartType",
                  "isOptional": true
                },
                {
                  "name": "isShared",
                  "isOptional": true
                },
                {
                  "name": "queryId",
                  "isOptional": true
                },
                {
                  "name": "formatResults",
                  "isOptional": true
                },
                {
                  "name": "partTitle",
                  "value": "Query 1",
                  "isOptional": true
                },
                {
                  "name": "queryScope",
                  "value": {
                    "scope": 0,
                    "values": []
                  },
                  "isOptional": true
                },
                {
                  "name": "query",
                  "value": "resources\n//Arc registered VMs (Windows & linux)\n| where type == \"microsoft.hybridcompute/machines\"\n//Boolean - SQL installed (true/false)\n| extend mssqlDiscovered = properties.mssqlDiscovered\n| where mssqlDiscovered == 'true'\n| summarize ServerCount = count()",
                  "isOptional": true
                }
              ],
              "type": "Extension/HubsExtension/PartType/ArgQuerySingleValueTile",
              "settings": {},
              "partHeader": {
                "title": "All Servers with SQL Server Discovered",
                "subtitle": "Count of Servers where SQL Server has been discovered"
              }
            }
          },
          "6": {
            "position": {
              "x": 10,
              "y": 7,
              "colSpan": 3,
              "rowSpan": 2
            },
            "metadata": {
              "inputs": [
                {
                  "name": "chartType",
                  "isOptional": true
                },
                {
                  "name": "isShared",
                  "isOptional": true
                },
                {
                  "name": "queryId",
                  "isOptional": true
                },
                {
                  "name": "formatResults",
                  "isOptional": true
                },
                {
                  "name": "partTitle",
                  "value": "Query 1",
                  "isOptional": true
                },
                {
                  "name": "query",
                  "value": "resources\n| where type == 'microsoft.azurearcdata/sqlserverinstances'\n| summarize SQLInstanceCount = count()\n",
                  "isOptional": true
                },
                {
                  "name": "queryScope",
                  "value": {
                    "scope": 0,
                    "values": []
                  },
                  "isOptional": true
                }
              ],
              "type": "Extension/HubsExtension/PartType/ArgQuerySingleValueTile",
              "settings": {},
              "partHeader": {
                "title": "Total SQL Server Instances",
                "subtitle": "Count of SQL Server instances hosted on VMs"
              }
            }
          },
          "7": {
            "position": {
              "x": 13,
              "y": 7,
              "colSpan": 6,
              "rowSpan": 8
            },
            "metadata": {
              "inputs": [
                {
                  "name": "isShared",
                  "isOptional": true
                },
                {
                  "name": "queryId",
                  "isOptional": true
                },
                {
                  "name": "formatResults",
                  "isOptional": true
                },
                {
                  "name": "partTitle",
                  "value": "Query 1",
                  "isOptional": true
                },
                {
                  "name": "chartType",
                  "value": 2,
                  "isOptional": true
                },
                {
                  "name": "queryScope",
                  "value": {
                    "scope": 0,
                    "values": []
                  },
                  "isOptional": true
                },
                {
                  "name": "query",
                  "value": "//SQL Server Paid/not paid Query\n//version 1 - returns where at least 1 SQL Server Instance is Standard or Enterprise\n//Complex Query which operates across 3 resource types\n//Goal of Query is to count Machines which have SQL Server installed AND at least one instance of Standard or Enterprise\n//Returns License Type value so we can determine which servers potentially have an incorrect or suboptimal License Type\n//\n//Resource Types used\n//1) resources where type == \"microsoft.hybridcompute/machines\" and mssqlDiscovered == 'true' - Azure Arc VMs holding at least 1 SQL Server install\n//2) resourcecontainers where type == 'microsoft.resources/subscriptions' - Owning subscription for VMs\n//3) resources where type == 'microsoft.azurearcdata/sqlserverinstances' - collection of SQL Server instances on VM\n//Note - we only need to determine if at least one SQL Server Enterprise or Standard exists on the Server, hence the distinct and filter\n//4) resources where type == \"microsoft.hybridcompute/machines/extensions\" and properties.type in (\"WindowsAgent.SqlServer\",\"LinuxAgent.SqlServer\") - Extension holding SQLServer Agent for Server\n//\n// 1) gives us the underlying SQL Server hosting VM\n// 2) gives us the owning subscription\n// 3) selects VMs with at least one instance of SQL Server Standard or Enterprise\n// 4) gets the license status (paid etc)\n//\n// 1) VMs with SQL\nresources \n//Arc registered VMs (Windows & linux)\n| where type == \"microsoft.hybridcompute/machines\"\n//Boolean - SQL installed (true/false)\n| extend mssqlDiscovered = properties.mssqlDiscovered\n| where mssqlDiscovered == 'true'\n| extend machineName = name\n| extend machineId = tolower(tostring(id))\n//\n// 2) Subscription Name\n| join kind=inner (\n    resourcecontainers\n    | where type == 'microsoft.resources/subscriptions'\n    | project subscriptionId, subscriptionName = name)\n    on subscriptionId\n//\n// 3) Does the VM host at least 1 instance of SQL Server Standard or Enterprise\n| join kind=inner (\n    resources\n    | where type == 'microsoft.azurearcdata/sqlserverinstances'\n    //SQL Server Version & Edition\n    | extend sqlVersion = tostring(properties.version)\n    | extend sqlEdition = tostring(properties.edition)\n    | extend sqlInstance = name\n    //needed for join - container is \"owning\" VM hosting SQL\n    | extend containerId = tolower(tostring (properties.containerResourceId))\n    //Does at least one instance contain Enterprise or Standard\n    | where sqlEdition in (\"Enterprise\", \"Standard\")\n    | where isnotempty(containerId)\n    //Machine may contain multiple instances of different versions & editions - this distinct narrows the count to 1\n    | distinct containerId)\non $left.machineId == $right.containerId\n//\n//4) Join for SQL Server Agent to retrieve Server Level License Type\n| join kind=inner (\n    resources\n    //Machine extensions resource type\n    | where type == \"microsoft.hybridcompute/machines/extensions\"\n    //Machine has SQL Server extension\n    | where properties.type in (\"WindowsAgent.SqlServer\",\"LinuxAgent.SqlServer\")\n    | extend licenseType = tostring(properties.settings.LicenseType)\n    //extract Machine name from ID\n    | extend machineIdHasSQLServerExtensionInstalled = tolower(iff(id contains \"/extensions/WindowsAgent.SqlServer\" or id contains \"/extensions/LinuxAgent.SqlServer\", substring(id, 0, indexof(id, \"/extensions/\")), \"\"))\n    )\non $left.machineId == $right.machineIdHasSQLServerExtensionInstalled\n| project subscriptionName, resourceGroup, machineName, licenseType\n| summarize serverCount = count() by  licenseType",
                  "isOptional": true
                }
              ],
              "type": "Extension/HubsExtension/PartType/ArgQueryChartTile",
              "settings": {},
              "partHeader": {
                "title": "SQL Server License Type for Enterprise & Standard",
                "subtitle": "Summary of SQL License Type settings across all Ent & Std SQL Servers"
              }
            }
          },
          "8": {
            "position": {
              "x": 6,
              "y": 9,
              "colSpan": 4,
              "rowSpan": 2
            },
            "metadata": {
              "inputs": [
                {
                  "name": "chartType",
                  "isOptional": true
                },
                {
                  "name": "isShared",
                  "isOptional": true
                },
                {
                  "name": "queryId",
                  "isOptional": true
                },
                {
                  "name": "formatResults",
                  "isOptional": true
                },
                {
                  "name": "partTitle",
                  "value": "Query 1",
                  "isOptional": true
                },
                {
                  "name": "query",
                  "value": "    resources\n    //Machine extensions resource type\n    | where type == \"microsoft.hybridcompute/machines/extensions\"\n    //Machine has SQL Server extension\n    | where properties.type in (\"WindowsAgent.SqlServer\",\"LinuxAgent.SqlServer\")\n    | summarize ExtensionCount = count()\n",
                  "isOptional": true
                },
                {
                  "name": "queryScope",
                  "value": {
                    "scope": 0,
                    "values": []
                  },
                  "isOptional": true
                }
              ],
              "type": "Extension/HubsExtension/PartType/ArgQuerySingleValueTile",
              "settings": {},
              "partHeader": {
                "title": "All Servers with SQL Agent installed",
                "subtitle": "These 2 figures should match"
              }
            }
          },
          "9": {
            "position": {
              "x": 10,
              "y": 9,
              "colSpan": 3,
              "rowSpan": 2
            },
            "metadata": {
              "inputs": [
                {
                  "name": "chartType",
                  "isOptional": true
                },
                {
                  "name": "isShared",
                  "isOptional": true
                },
                {
                  "name": "queryId",
                  "isOptional": true
                },
                {
                  "name": "formatResults",
                  "isOptional": true
                },
                {
                  "name": "partTitle",
                  "value": "Query 1",
                  "isOptional": true
                },
                {
                  "name": "query",
                  "value": "resources\n| where  type == \"microsoft.azurearcdata/sqlserverinstances/databases\"\n| summarize countDBs = count()",
                  "isOptional": true
                },
                {
                  "name": "queryScope",
                  "value": {
                    "scope": 0,
                    "values": []
                  },
                  "isOptional": true
                }
              ],
              "type": "Extension/HubsExtension/PartType/ArgQuerySingleValueTile",
              "settings": {},
              "partHeader": {
                "title": "Total SQL Server DBs",
                "subtitle": "Count of all DBs across all Instances"
              }
            }
          },
          "10": {
            "position": {
              "x": 6,
              "y": 11,
              "colSpan": 4,
              "rowSpan": 2
            },
            "metadata": {
              "inputs": [
                {
                  "name": "chartType",
                  "isOptional": true
                },
                {
                  "name": "isShared",
                  "isOptional": true
                },
                {
                  "name": "queryId",
                  "isOptional": true
                },
                {
                  "name": "formatResults",
                  "isOptional": true
                },
                {
                  "name": "partTitle",
                  "value": "Query 1",
                  "isOptional": true
                },
                {
                  "name": "query",
                  "value": "//SQL Server Paid/not paid Query\n//version 1 - returns where at least 1 SQL Server Instance is Standard or Enterprise\n//Complex Query which operates across 3 resource types\n//Goal of Query is to count Machines which have SQL Server installed AND at least one instance of Standard or Enterprise\n//Returns License Type value so we can determine which servers potentially have an incorrect or suboptimal License Type\n//\n//Resource Types used\n//1) resources where type == \"microsoft.hybridcompute/machines\" and mssqlDiscovered == 'true' - Azure Arc VMs holding at least 1 SQL Server install\n//2) resourcecontainers where type == 'microsoft.resources/subscriptions' - Owning subscription for VMs\n//3) resources where type == 'microsoft.azurearcdata/sqlserverinstances' - collection of SQL Server instances on VM\n//Note - we only need to determine if at least one SQL Server Enterprise or Standard exists on the Server, hence the distinct and filter\n//4) resources where type == \"microsoft.hybridcompute/machines/extensions\" and properties.type in (\"WindowsAgent.SqlServer\",\"LinuxAgent.SqlServer\") - Extension holding SQLServer Agent for Server\n//\n// 1) gives us the underlying SQL Server hosting VM\n// 2) gives us the owning subscription\n// 3) selects VMs with at least one instance of SQL Server Standard or Enterprise\n// 4) gets the license status (paid etc)\n//\n// 1) VMs with SQL\nresources \n//Arc registered VMs (Windows & linux)\n| where type == \"microsoft.hybridcompute/machines\"\n//Boolean - SQL installed (true/false)\n| extend mssqlDiscovered = properties.mssqlDiscovered\n| where mssqlDiscovered == 'true'\n| extend machineName = name\n| extend machineId = tolower(tostring(id))\n//\n// 2) Subscription Name\n| join kind=inner (\n    resourcecontainers\n    | where type == 'microsoft.resources/subscriptions'\n    | project subscriptionId, subscriptionName = name)\n    on subscriptionId\n//\n// 3) Does the VM host at least 1 instance of SQL Server Standard or Enterprise\n| join kind=inner (\n    resources\n    | where type == 'microsoft.azurearcdata/sqlserverinstances'\n    //SQL Server Version & Edition\n    | extend sqlVersion = tostring(properties.version)\n    | extend sqlEdition = tostring(properties.edition)\n    | extend sqlInstance = name\n    //needed for join - container is \"owning\" VM hosting SQL\n    | extend containerId = tolower(tostring (properties.containerResourceId))\n    //Does at least one instance contain Enterprise or Standard\n    | where sqlEdition in (\"Enterprise\", \"Standard\")\n    | where isnotempty(containerId)\n    //Machine may contain multiple instances of different versions & editions - this distinct narrows the count to 1\n    | distinct containerId)\non $left.machineId == $right.containerId\n//\n//4) Join for SQL Server Agent to retrieve Server Level License Type\n| join kind=inner (\n    resources\n    //Machine extensions resource type\n    | where type == \"microsoft.hybridcompute/machines/extensions\"\n    //Machine has SQL Server extension\n    | where properties.type in (\"WindowsAgent.SqlServer\",\"LinuxAgent.SqlServer\")\n    | extend licenseType = tostring(properties.settings.LicenseType)\n    //extract Machine name from ID\n    | extend machineIdHasSQLServerExtensionInstalled = tolower(iff(id contains \"/extensions/WindowsAgent.SqlServer\" or id contains \"/extensions/LinuxAgent.SqlServer\", substring(id, 0, indexof(id, \"/extensions/\")), \"\"))\n    )\non $left.machineId == $right.machineIdHasSQLServerExtensionInstalled\n| project subscriptionName, resourceGroup, machineName, licenseType\n| summarize serverCount = count() ",
                  "isOptional": true
                },
                {
                  "name": "queryScope",
                  "value": {
                    "scope": 0,
                    "values": []
                  },
                  "isOptional": true
                }
              ],
              "type": "Extension/HubsExtension/PartType/ArgQuerySingleValueTile",
              "settings": {},
              "partHeader": {
                "title": "All Servers with SQL Server Ent/Std",
                "subtitle": "Total VMs with at least one instance of Standard or Enterprisre Edition"
              }
            }
          },
          "11": {
            "position": {
              "x": 10,
              "y": 11,
              "colSpan": 3,
              "rowSpan": 2
            },
            "metadata": {
              "inputs": [
                {
                  "name": "chartType",
                  "isOptional": true
                },
                {
                  "name": "isShared",
                  "isOptional": true
                },
                {
                  "name": "queryId",
                  "isOptional": true
                },
                {
                  "name": "formatResults",
                  "isOptional": true
                },
                {
                  "name": "partTitle",
                  "value": "Query 1",
                  "isOptional": true
                },
                {
                  "name": "query",
                  "value": "//SQL Server Paid/not paid Query\n//version 1 - returns where at least 1 SQL Server Instance is Standard or Enterprise\n//Complex Query which operates across 3 resource types\n//Goal of Query is to count Machines which have SQL Server installed AND at least one instance of Standard or Enterprise\n//Returns License Type value so we can determine which servers potentially have an incorrect or suboptimal License Type\n//\n//Resource Types used\n//1) resources where type == \"microsoft.hybridcompute/machines\" and mssqlDiscovered == 'true' - Azure Arc VMs holding at least 1 SQL Server install\n//2) resourcecontainers where type == 'microsoft.resources/subscriptions' - Owning subscription for VMs\n//3) resources where type == 'microsoft.azurearcdata/sqlserverinstances' - collection of SQL Server instances on VM\n//Note - we only need to determine if at least one SQL Server Enterprise or Standard exists on the Server, hence the distinct and filter\n//4) resources where type == \"microsoft.hybridcompute/machines/extensions\" and properties.type in (\"WindowsAgent.SqlServer\",\"LinuxAgent.SqlServer\") - Extension holding SQLServer Agent for Server\n//\n// 1) gives us the underlying SQL Server hosting VM\n// 2) gives us the owning subscription\n// 3) selects VMs with at least one instance of SQL Server Standard or Enterprise\n// 4) gets the license status (paid etc)\n//\n// 1) VMs with SQL\nresources \n//Arc registered VMs (Windows & linux)\n| where type == \"microsoft.hybridcompute/machines\"\n//Boolean - SQL installed (true/false)\n| extend mssqlDiscovered = properties.mssqlDiscovered\n| where mssqlDiscovered == 'true'\n| extend machineName = name\n| extend machineId = tolower(tostring(id))\n//\n// 2) Subscription Name\n| join kind=inner (\n    resourcecontainers\n    | where type == 'microsoft.resources/subscriptions'\n    | project subscriptionId, subscriptionName = name)\n    on subscriptionId\n//\n// 3) Does the VM host at least 1 instance of SQL Server Standard or Enterprise\n| join kind=inner (\n    resources\n    | where type == 'microsoft.azurearcdata/sqlserverinstances'\n    //SQL Server Version & Edition\n    | extend sqlVersion = tostring(properties.version)\n    | extend sqlEdition = tostring(properties.edition)\n    | extend sqlInstance = name\n    //needed for join - container is \"owning\" VM hosting SQL\n    | extend containerId = tolower(tostring (properties.containerResourceId))\n    //Does NOT have at least one instance contain Enterprise or Standard\n    | where sqlEdition !in (\"Enterprise\", \"Standard\")\n    | where isnotempty(containerId)\n    //Machine may contain multiple instances of different versions & editions - this distinct narrows the count to 1\n    | distinct containerId)\non $left.machineId == $right.containerId\n//\n//4) Join for SQL Server Agent to retrieve Server Level License Type\n| join kind=inner (\n    resources\n    //Machine extensions resource type\n    | where type == \"microsoft.hybridcompute/machines/extensions\"\n    //Machine has SQL Server extension\n    | where properties.type in (\"WindowsAgent.SqlServer\",\"LinuxAgent.SqlServer\")\n    | extend licenseType = tostring(properties.settings.LicenseType)\n    //extract Machine name from ID\n    | extend machineIdHasSQLServerExtensionInstalled = tolower(iff(id contains \"/extensions/WindowsAgent.SqlServer\" or id contains \"/extensions/LinuxAgent.SqlServer\", substring(id, 0, indexof(id, \"/extensions/\")), \"\"))\n    )\non $left.machineId == $right.machineIdHasSQLServerExtensionInstalled\n| project subscriptionName, resourceGroup, machineName, licenseType\n| summarize serverCount = count() ",
                  "isOptional": true
                },
                {
                  "name": "queryScope",
                  "value": {
                    "scope": 0,
                    "values": []
                  },
                  "isOptional": true
                }
              ],
              "type": "Extension/HubsExtension/PartType/ArgQuerySingleValueTile",
              "settings": {},
              "partHeader": {
                "title": "All Servers with other SQL Server editions",
                "subtitle": "VMs with SQL Server Express etc"
              }
            }
          },
          "12": {
            "position": {
              "x": 6,
              "y": 13,
              "colSpan": 4,
              "rowSpan": 2
            },
            "metadata": {
              "inputs": [
                {
                  "name": "chartType",
                  "isOptional": true
                },
                {
                  "name": "isShared",
                  "isOptional": true
                },
                {
                  "name": "queryId",
                  "isOptional": true
                },
                {
                  "name": "formatResults",
                  "isOptional": true
                },
                {
                  "name": "partTitle",
                  "value": "Query 1",
                  "isOptional": true
                },
                {
                  "name": "queryScope",
                  "value": {
                    "scope": 0,
                    "values": []
                  },
                  "isOptional": true
                },
                {
                  "name": "query",
                  "value": "resources\n| where type == 'microsoft.azurearcdata/sqlserverinstances'\n| extend provisioningState = tostring(properties.provisioningState)\n| extend status = tostring(properties.status)\n| where provisioningState == \"Succeeded\"\n| summarize succeedededProvisioningInstanceCount = count()",
                  "isOptional": true
                }
              ],
              "type": "Extension/HubsExtension/PartType/ArgQuerySingleValueTile",
              "settings": {},
              "partHeader": {
                "title": "Successfully provisioned SQL Server Instances",
                "subtitle": "Count of Instances correctly provisioned"
              }
            }
          },
          "13": {
            "position": {
              "x": 10,
              "y": 13,
              "colSpan": 3,
              "rowSpan": 2
            },
            "metadata": {
              "inputs": [
                {
                  "name": "chartType",
                  "isOptional": true
                },
                {
                  "name": "isShared",
                  "isOptional": true
                },
                {
                  "name": "queryId",
                  "isOptional": true
                },
                {
                  "name": "formatResults",
                  "isOptional": true
                },
                {
                  "name": "partTitle",
                  "value": "Query 1",
                  "isOptional": true
                },
                {
                  "name": "queryScope",
                  "value": {
                    "scope": 0,
                    "values": []
                  },
                  "isOptional": true
                },
                {
                  "name": "query",
                  "value": "resources\n| where type == 'microsoft.azurearcdata/sqlserverinstances'\n| extend provisioningState = tostring(properties.provisioningState)\n| extend status = tostring(properties.status)\n| where status == \"Connected\"\n| summarize connectedInstanceCount = count()",
                  "isOptional": true
                }
              ],
              "type": "Extension/HubsExtension/PartType/ArgQuerySingleValueTile",
              "settings": {},
              "partHeader": {
                "title": "Connected SQL Server Instances",
                "subtitle": "Count of Instances connected fully to Arc"
              }
            }
          },
          "14": {
            "position": {
              "x": 0,
              "y": 15,
              "colSpan": 19,
              "rowSpan": 6
            },
            "metadata": {
              "inputs": [
                {
                  "name": "chartType",
                  "isOptional": true
                },
                {
                  "name": "isShared",
                  "isOptional": true
                },
                {
                  "name": "queryId",
                  "isOptional": true
                },
                {
                  "name": "formatResults",
                  "isOptional": true
                },
                {
                  "name": "partTitle",
                  "value": "Query 1",
                  "isOptional": true
                },
                {
                  "name": "queryScope",
                  "value": {
                    "scope": 0,
                    "values": []
                  },
                  "isOptional": true
                },
                {
                  "name": "query",
                  "value": "//SQL Server Paid/not paid Query\r\n//version 1 - returns where at least 1 SQL Server Instance is Standard or Enterprise\r\n//Complex Query which operates across 3 resource types\r\n//Goal of Query is to count Machines which have SQL Server installed AND at least one instance of Standard or Enterprise\r\n//Returns License Type value so we can determine which servers potentially have an incorrect or suboptimal License Type\r\n//\r\n//Resource Types used\r\n//1) resources where type == \"microsoft.hybridcompute/machines\" and mssqlDiscovered == 'true' - Azure Arc VMs holding at least 1 SQL Server install\r\n//2) resourcecontainers where type == 'microsoft.resources/subscriptions' - Owning subscription for VMs\r\n//3) resources where type == 'microsoft.azurearcdata/sqlserverinstances' - collection of SQL Server instances on VM\r\n//Note - we only need to determine if at least one SQL Server Enterprise or Standard exists on the Server, hence the distinct and filter\r\n//4) resources where type == \"microsoft.hybridcompute/machines/extensions\" and properties.type in (\"WindowsAgent.SqlServer\",\"LinuxAgent.SqlServer\") - Extension holding SQLServer Agent for Server\r\n//\r\n// 1) gives us the underlying SQL Server hosting VM\r\n// 2) gives us the owning subscription\r\n// 3) selects VMs with at least one instance of SQL Server Standard or Enterprise\r\n// 4) gets the license status (paid etc)\r\n//\r\n// 1) VMs with SQL\r\nresources \r\n//Arc registered VMs (Windows & linux)\r\n| where type == \"microsoft.hybridcompute/machines\"\r\n//Boolean - SQL installed (true/false)\r\n| extend mssqlDiscovered = properties.mssqlDiscovered\r\n| where mssqlDiscovered == 'true'\r\n| extend machineName = name\r\n| extend machineId = tolower(tostring(id))\r\n//\r\n// 2) Subscription Name\r\n| join kind=inner (\r\n    resourcecontainers\r\n    | where type == 'microsoft.resources/subscriptions'\r\n    | project subscriptionId, subscriptionName = name)\r\n    on subscriptionId\r\n//\r\n// 3) Does the VM host at least 1 instance of SQL Server Standard or Enterprise\r\n| join kind=inner (\r\n    resources\r\n    | where type == 'microsoft.azurearcdata/sqlserverinstances'\r\n    //SQL Server Version & Edition\r\n    | extend sqlVersion = tostring(properties.version)\r\n    | extend sqlEdition = tostring(properties.edition)\r\n    | extend sqlInstance = name\r\n    //needed for join - container is \"owning\" VM hosting SQL\r\n    | extend containerId = tolower(tostring (properties.containerResourceId))\r\n    //Does at least one instance contain Enterprise or Standard\r\n    | where sqlEdition in (\"Enterprise\", \"Standard\")\r\n    | where isnotempty(containerId)\r\n    //Machine may contain multiple instances of different versions & editions - this distinct narrows the count to 1\r\n    | distinct containerId)\r\non $left.machineId == $right.containerId\r\n//\r\n//4) Join for SQL Server Agent to retrieve Server Level License Type\r\n| join kind=inner (\r\n    resources\r\n    //Machine extensions resource type\r\n    | where type == \"microsoft.hybridcompute/machines/extensions\"\r\n    //Machine has SQL Server extension\r\n    | where properties.type in (\"WindowsAgent.SqlServer\",\"LinuxAgent.SqlServer\")\r\n    | extend licenseType = tostring(properties.settings.LicenseType)\r\n    //extract Machine name from ID\r\n    | extend machineIdHasSQLServerExtensionInstalled = tolower(iff(id contains \"/extensions/WindowsAgent.SqlServer\" or id contains \"/extensions/LinuxAgent.SqlServer\", substring(id, 0, indexof(id, \"/extensions/\")), \"\"))\r\n    )\r\non $left.machineId == $right.machineIdHasSQLServerExtensionInstalled\r\n| project subscriptionName, resourceGroup, machineName, licenseType\r\n| summarize serverCount = count() by subscriptionName, resourceGroup, licenseType\r\n",
                  "isOptional": true
                }
              ],
              "type": "Extension/HubsExtension/PartType/ArgQueryGridTile",
              "settings": {},
              "partHeader": {
                "title": "SQL Server License Type Settings by Subscription, Resource Group for Enterprise & Standard",
                "subtitle": "Breakdown of SQL Server License Type settings for \"production\" SQL Servers"
              }
            }
          },
          "15": {
            "position": {
              "x": 0,
              "y": 21,
              "colSpan": 19,
              "rowSpan": 5
            },
            "metadata": {
              "inputs": [
                {
                  "name": "chartType",
                  "isOptional": true
                },
                {
                  "name": "isShared",
                  "isOptional": true
                },
                {
                  "name": "queryId",
                  "isOptional": true
                },
                {
                  "name": "formatResults",
                  "isOptional": true
                },
                {
                  "name": "partTitle",
                  "value": "Query 1",
                  "isOptional": true
                },
                {
                  "name": "query",
                  "value": "// Arc Queries - All Windows Servers by Subscription, Resource Group, Type\r\nresources\r\n| where type =~ 'microsoft.hybridcompute/machines'\r\n| extend CoreCount = toint (properties.detectedProperties.logicalCoreCount)\r\n| extend OSVersion = tostring(properties.osSku)\r\n| extend ESUAttached = iff(properties.licenseProfile.esuProfile.esuKeyState ==\"Inactive\", 0, 1)\r\n| join kind=inner (\r\n    resourcecontainers\r\n    | where type == 'microsoft.resources/subscriptions'\r\n    | project subscriptionId, subscriptionName = name)\r\n    on subscriptionId\r\n| project subscriptionName, resourceGroup, OSVersion, ESUAttached, CoreCount\r\n| summarize ServerCount = count() , TotalCores = sum(CoreCount), TotalESU =sum(ESUAttached) by subscriptionName, resourceGroup, OSVersion",
                  "isOptional": true
                },
                {
                  "name": "queryScope",
                  "value": {
                    "scope": 0,
                    "values": []
                  },
                  "isOptional": true
                }
              ],
              "type": "Extension/HubsExtension/PartType/ArgQueryGridTile",
              "settings": {},
              "partHeader": {
                "title": "Servers -Summary",
                "subtitle": "All Servers by Subscription, Resource Group, OS Version"
              }
            }
          },
          "16": {
            "position": {
              "x": 0,
              "y": 26,
              "colSpan": 19,
              "rowSpan": 5
            },
            "metadata": {
              "inputs": [
                {
                  "name": "chartType",
                  "isOptional": true
                },
                {
                  "name": "isShared",
                  "isOptional": true
                },
                {
                  "name": "queryId",
                  "isOptional": true
                },
                {
                  "name": "formatResults",
                  "isOptional": true
                },
                {
                  "name": "partTitle",
                  "value": "Query 1",
                  "isOptional": true
                },
                {
                  "name": "queryScope",
                  "value": {
                    "scope": 0,
                    "values": []
                  },
                  "isOptional": true
                },
                {
                  "name": "query",
                  "value": "// Run query to see results.\r\nresources\r\n| where type == \"microsoft.azurearcdata/sqlserverinstances\"\r\n| extend d=parse_json(properties)\r\n| extend Patch=d[\"patchLevel\"]\r\n| extend SQLVersion=d[\"version\"]\r\n| extend  Edition=d[\"edition\"]\r\n| extend License=d[\"licenseType\"]\r\n| join kind=inner (\r\n    resourcecontainers\r\n    | where type == 'microsoft.resources/subscriptions'\r\n    | project subscriptionId, subscriptionName = name)\r\n    on subscriptionId\r\n| project subscriptionName, resourceGroup, Patch, SQLVersion, Edition, License\r\n| summarize ServerCount=count() by subscriptionName, resourceGroup, tostring(SQLVersion)",
                  "isOptional": true
                }
              ],
              "type": "Extension/HubsExtension/PartType/ArgQueryGridTile",
              "settings": {},
              "partHeader": {
                "title": "SQL Servers -Summary",
                "subtitle": "All Servers by Subscription, Resource Group, Version"
              }
            }
          },
          "17": {
            "position": {
              "x": 0,
              "y": 31,
              "colSpan": 19,
              "rowSpan": 6
            },
            "metadata": {
              "inputs": [
                {
                  "name": "chartType",
                  "isOptional": true
                },
                {
                  "name": "isShared",
                  "isOptional": true
                },
                {
                  "name": "queryId",
                  "isOptional": true
                },
                {
                  "name": "formatResults",
                  "isOptional": true
                },
                {
                  "name": "partTitle",
                  "value": "Query 1",
                  "isOptional": true
                },
                {
                  "name": "queryScope",
                  "value": {
                    "scope": 0,
                    "values": []
                  },
                  "isOptional": true
                },
                {
                  "name": "query",
                  "value": "// Arc Queries - All Windows Servers by Subscription, Resource Group, Type\r\nresources\r\n| where type =~ 'microsoft.hybridcompute/machines'\r\n| extend coreCount = toint(properties.detectedProperties.coreCount)\r\n| extend mssqlDiscovered = properties.mssqlDiscovered\r\n//Operating System\r\n| extend osSku = tostring(properties.osSku)\r\n| extend osName = tostring(properties.osName)\r\n| extend osVersion = tostring(properties.osVersion)\r\n//Windows or Linux\r\n| extend osType = tostring(properties.osType)\r\n//OS Edition (Datacenter or Standard) \r\n| extend osEdition = iff(properties.osSku contains \"Datacenter\", \"Datacenter\", \"Standard\")\r\n| extend ESU = properties.licenseProfile.esuProfile.licenseAssignmentState\r\n| join kind=inner (\r\n    resourcecontainers\r\n    | where type == 'microsoft.resources/subscriptions'\r\n    | project subscriptionId, subscriptionName = name)\r\n    on subscriptionId\r\n| project subscriptionName, resourceGroup, ComputerName = name, osSku, osName, osVersion, osType, osEdition,ESU,mssqlDiscovered,coreCount",
                  "isOptional": true
                }
              ],
              "type": "Extension/HubsExtension/PartType/ArgQueryGridTile",
              "settings": {},
              "partHeader": {
                "title": "Servers - Detail",
                "subtitle": "All Servers enrolled on Arc"
              }
            }
          },
          "18": {
            "position": {
              "x": 0,
              "y": 37,
              "colSpan": 19,
              "rowSpan": 5
            },
            "metadata": {
              "inputs": [
                {
                  "name": "partTitle",
                  "value": "Query 1",
                  "isOptional": true
                },
                {
                  "name": "chartType",
                  "isOptional": true
                },
                {
                  "name": "isShared",
                  "isOptional": true
                },
                {
                  "name": "queryId",
                  "isOptional": true
                },
                {
                  "name": "formatResults",
                  "isOptional": true
                },
                {
                  "name": "queryScope",
                  "value": {
                    "scope": 0,
                    "values": []
                  },
                  "isOptional": true
                },
                {
                  "name": "query",
                  "value": "// Run query to see results.\r\nresources\r\n| where type == \"microsoft.azurearcdata/sqlserverinstances\"\r\n| extend d=parse_json(properties)\r\n| extend patch=d[\"patchLevel\"]\r\n| extend sqlVersion=d[\"version\"]\r\n| extend  edition=d[\"edition\"]\r\n| extend licenseType=d[\"licenseType\"]\r\n| join kind=inner (\r\n    resourcecontainers\r\n    | where type == 'microsoft.resources/subscriptions'\r\n    | project subscriptionId, subscriptionName = name)\r\n    on subscriptionId\r\n| project subscriptionName, resourceGroup, name, patch, sqlVersion, edition, licenseType",
                  "isOptional": true
                }
              ],
              "type": "Extension/HubsExtension/PartType/ArgQueryGridTile",
              "settings": {
                "content": {}
              },
              "partHeader": {
                "title": "SQL Servers - Detail",
                "subtitle": "All SQL Servers on Arc registered Servers"
              }
            }
          }
        }
      }
    },
    "metadata": {
      "model": {
        "timeRange": {
          "value": {
            "relative": {
              "duration": 24,
              "timeUnit": 1
            }
          },
          "type": "MsPortalFx.Composition.Configuration.ValueTypes.TimeRange"
        }
      }
    }
  },
  "name": "Arc - Rollout Progress Tracker (draft)",
  "type": "Microsoft.Portal/dashboards",
  "location": "INSERT LOCATION",
  "tags": {
    "hidden-title": "Arc - Rollout Progress Tracker (draft)"
  },
  "apiVersion": "2015-08-01-preview"
}